# Talex Touch ç»Ÿä¸€ä¸‹è½½ä¸­å¿ƒäº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

## ä¸€ã€äº§å“èƒŒæ™¯

### 1.1 ç°çŠ¶åˆ†æ

Talex Touch åº”ç”¨ç›®å‰å­˜åœ¨å¤šç§ä¸‹è½½åœºæ™¯ï¼š
- **åº”ç”¨æ›´æ–°**ï¼šé€šè¿‡GitHub Releasesä¸‹è½½æ–°ç‰ˆæœ¬å®‰è£…åŒ…
- **æ’ä»¶å®‰è£…**ï¼šä»NPMã€GitHubã€TPEXç­‰æºä¸‹è½½æ’ä»¶åŒ…
- **èµ„æºæ–‡ä»¶**ï¼šä¸‹è½½å›¾æ ‡ã€ä¸»é¢˜ã€è¯­è¨€åŒ…ç­‰èµ„æº

å½“å‰å„æ¨¡å—ç‹¬ç«‹å¤„ç†ä¸‹è½½ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- ç¼ºä¹ç»Ÿä¸€çš„ä¸‹è½½ç®¡ç†
- æ— æ³•æ§åˆ¶å¹¶å‘ä¸‹è½½æ•°é‡
- å¤§æ–‡ä»¶ä¸‹è½½å®¹æ˜“å¤±è´¥ä¸”æ— æ³•æ–­ç‚¹ç»­ä¼ 
- ç¼ºä¹ä¸‹è½½è¿›åº¦ç»Ÿä¸€å±•ç¤º
- æ— æ³•æ ¹æ®ä¼˜å…ˆçº§è°ƒåº¦ä¸‹è½½ä»»åŠ¡

### 1.2 æ ¸å¿ƒç—›ç‚¹

1. **ä¸‹è½½ç®¡ç†åˆ†æ•£**ï¼šå„æ¨¡å—ç‹¬ç«‹å®ç°ä¸‹è½½é€»è¾‘ï¼Œä»£ç é‡å¤
2. **å¤§æ–‡ä»¶ä¸‹è½½ä¸ç¨³å®š**ï¼šç¼ºä¹åˆ‡ç‰‡ä¸‹è½½å’Œæ–­ç‚¹ç»­ä¼ æœºåˆ¶
3. **å¹¶å‘æ§åˆ¶ç¼ºå¤±**ï¼šå¯èƒ½åŒæ—¶å¯åŠ¨è¿‡å¤šä¸‹è½½ä»»åŠ¡ï¼Œå½±å“ç½‘ç»œæ€§èƒ½
4. **ä¼˜å…ˆçº§ç®¡ç†æ··ä¹±**ï¼šæ— æ³•æ ¹æ®ä¸šåŠ¡é‡è¦æ€§è°ƒåº¦ä¸‹è½½ä»»åŠ¡
5. **ç”¨æˆ·ä½“éªŒå·®**ï¼šç¼ºä¹ç»Ÿä¸€çš„ä¸‹è½½è¿›åº¦å±•ç¤ºå’Œç®¡ç†ç•Œé¢
6. **å›½é™…åŒ–ç¼ºå¤±**ï¼šä¸‹è½½çŠ¶æ€ã€é”™è¯¯æç¤ºç­‰æ–‡æ¡ˆç¡¬ç¼–ç 

## äºŒã€äº§å“ç›®æ ‡

### 2.1 æ ¸å¿ƒç›®æ ‡

- å»ºç«‹ç»Ÿä¸€çš„ä¸‹è½½ç®¡ç†æœåŠ¡ï¼Œæ”¯æŒæ‰€æœ‰ä¸‹è½½åœºæ™¯
- å®ç°åˆ‡ç‰‡ä¸‹è½½å’Œæ–­ç‚¹ç»­ä¼ ï¼Œæå‡å¤§æ–‡ä»¶ä¸‹è½½æˆåŠŸç‡
- æ”¯æŒæ™ºèƒ½ä¼˜å…ˆçº§è°ƒåº¦ï¼Œä¼˜åŒ–ä¸‹è½½ä½“éªŒ
- æä¾›ç”¨æˆ·å¯é…ç½®çš„å¹¶å‘æ§åˆ¶ï¼Œå¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§
- å®ç°ç»Ÿä¸€çš„ä¸‹è½½ç®¡ç†ç•Œé¢ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- å…¨é¢æ”¯æŒi18nå›½é™…åŒ–ï¼Œæ‰€æœ‰çŠ¶æ€æ–‡æ¡ˆå¯æœ¬åœ°åŒ–

### 2.2 éç›®æ ‡

- æœ¬æœŸä¸å®ç°P2Pä¸‹è½½ï¼ˆåç»­å¯æ‰©å±•ï¼‰
- æœ¬æœŸä¸å®ç°ä¸‹è½½åŠ é€Ÿï¼ˆCDNä¼˜åŒ–ï¼‰
- æœ¬æœŸä¸å®ç°ä¸‹è½½é™é€Ÿï¼ˆå¸¦å®½æ§åˆ¶ï¼‰

## ä¸‰ã€åŠŸèƒ½éœ€æ±‚

### 3.1 ä¸‹è½½ä¸­å¿ƒæ¶æ„

#### 3.1.1 æ ¸å¿ƒç»„ä»¶è®¾è®¡

```typescript
// ä¸‹è½½ä¸­å¿ƒä¸»æ§åˆ¶å™¨
class DownloadCenter {
  private taskQueue: TaskQueue
  private downloadWorkers: DownloadWorker[]
  private chunkManager: ChunkManager
  private databaseService: DatabaseService
  private networkMonitor: NetworkMonitor

  // æ·»åŠ ä¸‹è½½ä»»åŠ¡
  async addTask(request: DownloadRequest): Promise<string>

  // æš‚åœ/æ¢å¤ä»»åŠ¡
  async pauseTask(taskId: string): Promise<void>
  async resumeTask(taskId: string): Promise<void>

  // å–æ¶ˆä»»åŠ¡
  async cancelTask(taskId: string): Promise<void>

  // è·å–ä»»åŠ¡çŠ¶æ€
  getTaskStatus(taskId: string): DownloadTaskStatus
  getAllTasks(): DownloadTaskStatus[]
}

// ä¸‹è½½ä»»åŠ¡è¯·æ±‚
interface DownloadRequest {
  id?: string
  url: string
  destination: string
  filename?: string
  priority: DownloadPriority
  module: DownloadModule
  metadata?: Record<string, any>
  checksum?: string
  headers?: Record<string, string>
}

// ä¸‹è½½ä¼˜å…ˆçº§æšä¸¾
enum DownloadPriority {
  CRITICAL = 100,    // ç”¨æˆ·æ‰‹åŠ¨è§¦å‘
  HIGH = 80,         // æ’ä»¶å®‰è£…
  NORMAL = 50,       // åº”ç”¨æ›´æ–°
  LOW = 20,          // èµ„æºæ–‡ä»¶
  BACKGROUND = 10    // åå°é¢„åŠ è½½
}

// ä¸‹è½½æ¨¡å—æšä¸¾
enum DownloadModule {
  APP_UPDATE = 'app_update',
  PLUGIN_INSTALL = 'plugin_install',
  RESOURCE_DOWNLOAD = 'resource_download',
  USER_MANUAL = 'user_manual'
}
```

#### 3.1.2 ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†

```typescript
// ä¼˜å…ˆçº§é˜Ÿåˆ—
class TaskQueue {
  private tasks: Map<string, DownloadTask> = new Map()
  private priorityQueue: PriorityQueue<DownloadTask>

  // æ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—
  enqueue(task: DownloadTask): void

  // è·å–ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œä»»åŠ¡
  dequeue(): DownloadTask | null

  // æ›´æ–°ä»»åŠ¡ä¼˜å…ˆçº§
  updatePriority(taskId: string, priority: DownloadPriority): void

  // è·å–é˜Ÿåˆ—çŠ¶æ€
  getQueueStatus(): QueueStatus
}

// ä¸‹è½½ä»»åŠ¡å®ä½“
interface DownloadTask {
  id: string
  url: string
  destination: string
  filename: string
  priority: DownloadPriority
  module: DownloadModule
  status: DownloadStatus
  progress: DownloadProgress
  chunks: ChunkInfo[]
  metadata: Record<string, any>
  createdAt: Date
  updatedAt: Date
  error?: string
}

// ä¸‹è½½çŠ¶æ€æšä¸¾
enum DownloadStatus {
  PENDING = 'pending',       // ç­‰å¾…ä¸­
  DOWNLOADING = 'downloading', // ä¸‹è½½ä¸­
  PAUSED = 'paused',         // å·²æš‚åœ
  COMPLETED = 'completed',   // å·²å®Œæˆ
  FAILED = 'failed',         // å¤±è´¥
  CANCELLED = 'cancelled'    // å·²å–æ¶ˆ
}
```

#### 3.1.3 åˆ‡ç‰‡ä¸‹è½½ç®¡ç†

```typescript
// åˆ‡ç‰‡ç®¡ç†å™¨
class ChunkManager {
  private readonly chunkSize: number = 1024 * 1024 // 1MB per chunk

  // åˆ›å»ºä¸‹è½½åˆ‡ç‰‡
  createChunks(task: DownloadTask): ChunkInfo[]

  // åˆå¹¶åˆ‡ç‰‡æ–‡ä»¶
  async mergeChunks(task: DownloadTask): Promise<void>

  // éªŒè¯åˆ‡ç‰‡å®Œæ•´æ€§
  async validateChunks(task: DownloadTask): Promise<boolean>

  // æ¸…ç†å¤±è´¥çš„åˆ‡ç‰‡
  async cleanupChunks(task: DownloadTask): Promise<void>
}

// åˆ‡ç‰‡ä¿¡æ¯
interface ChunkInfo {
  index: number
  start: number
  end: number
  size: number
  downloaded: number
  status: ChunkStatus
  filePath: string
}

enum ChunkStatus {
  PENDING = 'pending',
  DOWNLOADING = 'downloading',
  COMPLETED = 'completed',
  FAILED = 'failed'
}
```

#### 3.1.4 å¹¶å‘ä¸‹è½½å·¥ä½œå™¨

```typescript
// ä¸‹è½½å·¥ä½œå™¨
class DownloadWorker {
  private readonly maxConcurrent: number
  private activeTasks: Set<string> = new Set()
  private networkMonitor: NetworkMonitor

  // å¯åŠ¨ä¸‹è½½ä»»åŠ¡
  async startTask(task: DownloadTask): Promise<void>

  // æš‚åœä¸‹è½½ä»»åŠ¡
  async pauseTask(taskId: string): Promise<void>

  // æ¢å¤ä¸‹è½½ä»»åŠ¡
  async resumeTask(taskId: string): Promise<void>

  // å–æ¶ˆä¸‹è½½ä»»åŠ¡
  async cancelTask(taskId: string): Promise<void>

  // ä¸‹è½½å•ä¸ªåˆ‡ç‰‡
  private async downloadChunk(chunk: ChunkInfo, task: DownloadTask): Promise<void>
}

// ç½‘ç»œç›‘æ§å™¨
class NetworkMonitor {
  private speedHistory: number[] = []
  private latencyHistory: number[] = []

  // ç›‘æ§ç½‘ç»œçŠ¶å†µ
  async monitorNetwork(): Promise<NetworkStatus>

  // è·å–å»ºè®®çš„å¹¶å‘æ•°
  getRecommendedConcurrency(): number

  // æ£€æµ‹ç½‘ç»œå˜åŒ–
  onNetworkChange(callback: (status: NetworkStatus) => void): void
}

interface NetworkStatus {
  speed: number        // bytes/s
  latency: number      // ms
  stability: number     // 0-1
  recommendedConcurrency: number
}
```

### 3.2 æ•°æ®åº“è®¾è®¡

#### 3.2.1 æ•°æ®è¡¨ç»“æ„

ä½¿ç”¨Drizzle ORMè®¾è®¡SQLiteæ•°æ®åº“ï¼š

```typescript
// ä¸‹è½½ä»»åŠ¡è¡¨
export const downloadTasksSchema = sqliteTable('download_tasks', {
  id: text('id').primaryKey(),
  url: text('url').notNull(),
  destination: text('destination').notNull(),
  filename: text('filename').notNull(),
  priority: integer('priority').notNull(),
  module: text('module').notNull(),
  status: text('status').notNull(),
  totalSize: integer('total_size'),
  downloadedSize: integer('downloaded_size').default(0),
  checksum: text('checksum'),
  metadata: text('metadata'), // JSON string
  createdAt: integer('created_at').notNull(),
  updatedAt: integer('updated_at').notNull(),
  completedAt: integer('completed_at'),
  error: text('error')
})

// ä¸‹è½½åˆ‡ç‰‡è¡¨
export const downloadChunksSchema = sqliteTable('download_chunks', {
  id: text('id').primaryKey(),
  taskId: text('task_id').notNull().references(() => downloadTasksSchema.id),
  index: integer('index').notNull(),
  start: integer('start').notNull(),
  end: integer('end').notNull(),
  size: integer('size').notNull(),
  downloaded: integer('downloaded').default(0),
  status: text('status').notNull(),
  filePath: text('file_path').notNull(),
  createdAt: integer('created_at').notNull(),
  updatedAt: integer('updated_at').notNull()
})

// ä¸‹è½½å†å²è¡¨
export const downloadHistorySchema = sqliteTable('download_history', {
  id: text('id').primaryKey(),
  taskId: text('task_id').notNull(),
  url: text('url').notNull(),
  filename: text('filename').notNull(),
  module: text('module').notNull(),
  status: text('status').notNull(),
  totalSize: integer('total_size'),
  downloadedSize: integer('downloaded_size'),
  duration: integer('duration'), // seconds
  averageSpeed: integer('average_speed'), // bytes/s
  createdAt: integer('created_at').notNull(),
  completedAt: integer('completed_at')
})
```

#### 3.2.2 æ•°æ®åº“æœåŠ¡

```typescript
// æ•°æ®åº“æœåŠ¡
class DatabaseService {
  private db: DrizzleDatabase

  // ä¿å­˜ä¸‹è½½ä»»åŠ¡
  async saveTask(task: DownloadTask): Promise<void>

  // æ›´æ–°ä»»åŠ¡çŠ¶æ€
  async updateTaskStatus(taskId: string, status: DownloadStatus): Promise<void>

  // æ›´æ–°ä¸‹è½½è¿›åº¦
  async updateProgress(taskId: string, progress: DownloadProgress): Promise<void>

  // ä¿å­˜åˆ‡ç‰‡ä¿¡æ¯
  async saveChunks(taskId: string, chunks: ChunkInfo[]): Promise<void>

  // æ›´æ–°åˆ‡ç‰‡çŠ¶æ€
  async updateChunkStatus(chunkId: string, status: ChunkStatus): Promise<void>

  // è·å–ä»»åŠ¡å†å²
  async getTaskHistory(limit?: number): Promise<DownloadTask[]>

  // æ¸…ç†è¿‡æœŸæ•°æ®
  async cleanupExpiredData(days: number = 30): Promise<void>
}
```

### 3.3 æ™ºèƒ½ä¼˜å…ˆçº§è°ƒåº¦

#### 3.3.1 ä¼˜å…ˆçº§è®¡ç®—ç®—æ³•

```typescript
// ä¼˜å…ˆçº§è®¡ç®—å™¨
class PriorityCalculator {
  // è®¡ç®—ä»»åŠ¡ä¼˜å…ˆçº§
  calculatePriority(request: DownloadRequest): DownloadPriority {
    let basePriority = request.priority

    // æ ¹æ®æ¨¡å—è°ƒæ•´
    const moduleMultiplier = this.getModuleMultiplier(request.module)

    // æ ¹æ®æ–‡ä»¶å¤§å°è°ƒæ•´
    const sizeMultiplier = this.getSizeMultiplier(request.metadata?.fileSize)

    // æ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒæ•´
    const networkMultiplier = this.getNetworkMultiplier()

    return Math.min(100, Math.max(1,
      basePriority * moduleMultiplier * sizeMultiplier * networkMultiplier
    ))
  }

  private getModuleMultiplier(module: DownloadModule): number {
    const multipliers = {
      [DownloadModule.USER_MANUAL]: 1.2,
      [DownloadModule.PLUGIN_INSTALL]: 1.1,
      [DownloadModule.APP_UPDATE]: 1.0,
      [DownloadModule.RESOURCE_DOWNLOAD]: 0.9
    }
    return multipliers[module] || 1.0
  }

  private getSizeMultiplier(fileSize?: number): number {
    if (!fileSize) return 1.0

    // å°æ–‡ä»¶ä¼˜å…ˆçº§ç¨é«˜
    if (fileSize < 10 * 1024 * 1024) return 1.1 // < 10MB
    if (fileSize > 100 * 1024 * 1024) return 0.9 // > 100MB
    return 1.0
  }

  private getNetworkMultiplier(): number {
    // æ ¹æ®ç½‘ç»œçŠ¶å†µåŠ¨æ€è°ƒæ•´
    const networkStatus = NetworkMonitor.getCurrentStatus()
    if (networkStatus.speed < 1024 * 1024) return 1.2 // æ…¢ç½‘ç»œ
    if (networkStatus.speed > 10 * 1024 * 1024) return 0.8 // å¿«ç½‘ç»œ
    return 1.0
  }
}
```

#### 3.3.2 åŠ¨æ€ä¼˜å…ˆçº§è°ƒæ•´

```typescript
// ä¼˜å…ˆçº§è°ƒæ•´å™¨
class PriorityAdjuster {
  // æ ¹æ®ç”¨æˆ·è¡Œä¸ºè°ƒæ•´ä¼˜å…ˆçº§
  adjustByUserAction(taskId: string, action: UserAction): void {
    switch (action) {
      case UserAction.MANUAL_START:
        this.boostPriority(taskId, 20)
        break
      case UserAction.FREQUENT_RETRY:
        this.boostPriority(taskId, 10)
        break
      case UserAction.IGNORE:
        this.lowerPriority(taskId, 30)
        break
    }
  }

  // æ ¹æ®æ—¶é—´è°ƒæ•´ä¼˜å…ˆçº§
  adjustByTime(taskId: string): void {
    const task = this.getTask(taskId)
    const age = Date.now() - task.createdAt.getTime()

    // è¶…è¿‡1å°æ—¶çš„ä»»åŠ¡ä¼˜å…ˆçº§é™ä½
    if (age > 60 * 60 * 1000) {
      this.lowerPriority(taskId, 10)
    }
  }
}

enum UserAction {
  MANUAL_START = 'manual_start',
  FREQUENT_RETRY = 'frequent_retry',
  IGNORE = 'ignore',
  PAUSE = 'pause',
  RESUME = 'resume'
}
```

### 3.4 å¹¶å‘æ§åˆ¶

#### 3.4.1 ç”¨æˆ·é…ç½®

```typescript
// å¹¶å‘é…ç½®
interface ConcurrencyConfig {
  maxConcurrent: number        // æœ€å¤§å¹¶å‘æ•° (1-10)
  autoAdjust: boolean          // è‡ªåŠ¨è°ƒæ•´
  networkAware: boolean       // ç½‘ç»œæ„ŸçŸ¥
  priorityBased: boolean       // åŸºäºä¼˜å…ˆçº§
}

// é»˜è®¤é…ç½®
const defaultConcurrencyConfig: ConcurrencyConfig = {
  maxConcurrent: 3,
  autoAdjust: true,
  networkAware: true,
  priorityBased: true
}
```

#### 3.4.2 è‡ªåŠ¨è°ƒæ•´ç®—æ³•

```typescript
// å¹¶å‘è°ƒæ•´å™¨
class ConcurrencyAdjuster {
  private config: ConcurrencyConfig
  private networkMonitor: NetworkMonitor

  // è®¡ç®—å»ºè®®çš„å¹¶å‘æ•°
  calculateRecommendedConcurrency(): number {
    const networkStatus = this.networkMonitor.getCurrentStatus()
    const baseConcurrency = this.config.maxConcurrent

    if (!this.config.autoAdjust) {
      return baseConcurrency
    }

    // æ ¹æ®ç½‘ç»œé€Ÿåº¦è°ƒæ•´
    let multiplier = 1.0
    if (networkStatus.speed > 10 * 1024 * 1024) multiplier = 1.5 // > 10MB/s
    else if (networkStatus.speed < 1 * 1024 * 1024) multiplier = 0.5 // < 1MB/s

    // æ ¹æ®ç½‘ç»œç¨³å®šæ€§è°ƒæ•´
    if (networkStatus.stability < 0.5) multiplier *= 0.7

    return Math.max(1, Math.min(10, Math.round(baseConcurrency * multiplier)))
  }

  // åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°
  adjustConcurrency(): void {
    const recommended = this.calculateRecommendedConcurrency()
    const current = this.getCurrentConcurrency()

    if (recommended !== current) {
      this.updateConcurrency(recommended)
    }
  }
}
```

### 3.5 ç”¨æˆ·ç•Œé¢

#### 3.5.1 ä¸‹è½½ä¸­å¿ƒé¢æ¿

**ç•Œé¢å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ ä¸‹è½½ä¸­å¿ƒ                                    [è®¾ç½®]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿›è¡Œä¸­ (2)                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”„ æ’ä»¶å®‰è£…: touch-music v1.2.0             45.2MB â”‚ â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60% 2.1MB/s å‰©ä½™ 15ç§’        â”‚ â”‚
â”‚  â”‚ [æš‚åœ] [å–æ¶ˆ]                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”„ åº”ç”¨æ›´æ–°: TalexTouch v2.1.0              89.5MB â”‚ â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 80% 3.2MB/s å‰©ä½™ 8ç§’          â”‚ â”‚
â”‚  â”‚ [æš‚åœ] [å–æ¶ˆ]                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­‰å¾…ä¸­ (3)                                             â”‚
â”‚  â€¢ èµ„æºæ–‡ä»¶: icon-pack-v2.zip                   12.3MB â”‚
â”‚  â€¢ æ’ä»¶å®‰è£…: touch-translation v1.0.5           8.7MB  â”‚
â”‚  â€¢ èµ„æºæ–‡ä»¶: theme-dark.zip                     5.2MB  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·²å®Œæˆ (15) [æŸ¥çœ‹å…¨éƒ¨]                                â”‚
â”‚  å¤±è´¥ (2) [é‡è¯•å…¨éƒ¨]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.5.2 è®¾ç½®é¡µé¢

**ä¸‹è½½è®¾ç½®æ¨¡å—**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ ä¸‹è½½è®¾ç½®                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¹¶å‘ä¸‹è½½æ•°: [3 â–¼] (1-10)                             â”‚
â”‚  âœ… è‡ªåŠ¨è°ƒæ•´å¹¶å‘æ•°                                     â”‚
â”‚  âœ… ç½‘ç»œæ„ŸçŸ¥è°ƒæ•´                                       â”‚
â”‚  âœ… åŸºäºä¼˜å…ˆçº§è°ƒåº¦                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åˆ‡ç‰‡è®¾ç½®                                             â”‚
â”‚  åˆ‡ç‰‡å¤§å°: [1MB â–¼] (512KB, 1MB, 2MB, 4MB)            â”‚
â”‚  âœ… æ–­ç‚¹ç»­ä¼                                            â”‚
â”‚  âœ… è‡ªåŠ¨é‡è¯• (æœ€å¤š3æ¬¡)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­˜å‚¨è®¾ç½®                                             â”‚
â”‚  ä¸´æ—¶æ–‡ä»¶ç›®å½•: /Users/xxx/Downloads/TalexTouch         â”‚
â”‚  å†å²è®°å½•ä¿ç•™: [30å¤© â–¼] (7å¤©, 30å¤©, 90å¤©, æ°¸ä¹…)       â”‚
â”‚  âœ… ä¸‹è½½å®Œæˆåè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 å›½é™…åŒ–æ”¯æŒ

#### 3.6.1 i18n Key æ¸…å•

**ä¸‹è½½ä¸­å¿ƒç•Œé¢æ–‡æ¡ˆ**ï¼š
```json
{
  "download": {
    "title": "ä¸‹è½½ä¸­å¿ƒ",
    "settings": "è®¾ç½®",
    "downloading": "è¿›è¡Œä¸­",
    "waiting": "ç­‰å¾…ä¸­",
    "completed": "å·²å®Œæˆ",
    "failed": "å¤±è´¥",
    "view_all": "æŸ¥çœ‹å…¨éƒ¨",
    "retry_all": "é‡è¯•å…¨éƒ¨",
    "pause": "æš‚åœ",
    "resume": "ç»§ç»­",
    "cancel": "å–æ¶ˆ",
    "retry": "é‡è¯•",
    "remove": "ç§»é™¤",
    "speed": "é€Ÿåº¦",
    "remaining": "å‰©ä½™",
    "size": "å¤§å°",
    "progress": "è¿›åº¦"
  }
}
```

**ä¸‹è½½çŠ¶æ€æ–‡æ¡ˆ**ï¼š
```json
{
  "download": {
    "status": {
      "pending": "ç­‰å¾…ä¸­",
      "downloading": "ä¸‹è½½ä¸­",
      "paused": "å·²æš‚åœ",
      "completed": "å·²å®Œæˆ",
      "failed": "ä¸‹è½½å¤±è´¥",
      "cancelled": "å·²å–æ¶ˆ"
    },
    "error": {
      "network": "ç½‘ç»œè¿æ¥å¤±è´¥",
      "timeout": "ä¸‹è½½è¶…æ—¶",
      "disk_full": "ç£ç›˜ç©ºé—´ä¸è¶³",
      "permission": "æƒé™ä¸è¶³",
      "checksum": "æ–‡ä»¶æ ¡éªŒå¤±è´¥",
      "unknown": "æœªçŸ¥é”™è¯¯"
    }
  }
}
```

**è®¾ç½®é¡µé¢æ–‡æ¡ˆ**ï¼š
```json
{
  "settings": {
    "download": {
      "title": "ä¸‹è½½è®¾ç½®",
      "concurrency": "å¹¶å‘ä¸‹è½½æ•°",
      "auto_adjust": "è‡ªåŠ¨è°ƒæ•´å¹¶å‘æ•°",
      "network_aware": "ç½‘ç»œæ„ŸçŸ¥è°ƒæ•´",
      "priority_based": "åŸºäºä¼˜å…ˆçº§è°ƒåº¦",
      "chunk_size": "åˆ‡ç‰‡å¤§å°",
      "resume": "æ–­ç‚¹ç»­ä¼ ",
      "auto_retry": "è‡ªåŠ¨é‡è¯•",
      "temp_dir": "ä¸´æ—¶æ–‡ä»¶ç›®å½•",
      "history_retention": "å†å²è®°å½•ä¿ç•™",
      "auto_cleanup": "ä¸‹è½½å®Œæˆåè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶"
    }
  }
}
```

## å››ã€æŠ€æœ¯è®¾è®¡

### 4.1 æ¨¡å—æ¶æ„

```
DownloadCenter (ä¸»è¿›ç¨‹æ¨¡å—)
â”œâ”€â”€ TaskQueue (ä¼˜å…ˆçº§é˜Ÿåˆ—)
â”œâ”€â”€ DownloadWorker[] (å¹¶å‘ä¸‹è½½å·¥ä½œå™¨)
â”œâ”€â”€ ChunkManager (åˆ‡ç‰‡ç®¡ç†)
â”œâ”€â”€ DatabaseService (SQLiteæŒä¹…åŒ–)
â”œâ”€â”€ NetworkMonitor (ç½‘ç»œçŠ¶å†µç›‘æ§)
â”œâ”€â”€ PriorityCalculator (ä¼˜å…ˆçº§è®¡ç®—)
â”œâ”€â”€ ConcurrencyAdjuster (å¹¶å‘è°ƒæ•´)
â””â”€â”€ DownloadCenterUI (å‰ç«¯ç•Œé¢)
```

### 4.2 æ–‡ä»¶ç»“æ„

**æ–°å¢æ–‡ä»¶**ï¼š
- `apps/core-app/src/main/modules/download/download-center.ts` - ä¸‹è½½ä¸­å¿ƒä¸»æ¨¡å—
- `apps/core-app/src/main/modules/download/task-queue.ts` - ä»»åŠ¡é˜Ÿåˆ—
- `apps/core-app/src/main/modules/download/download-worker.ts` - ä¸‹è½½å·¥ä½œå™¨
- `apps/core-app/src/main/modules/download/chunk-manager.ts` - åˆ‡ç‰‡ç®¡ç†
- `apps/core-app/src/main/modules/download/database-service.ts` - æ•°æ®åº“æœåŠ¡
- `apps/core-app/src/main/modules/download/network-monitor.ts` - ç½‘ç»œç›‘æ§
- `apps/core-app/src/main/modules/download/priority-calculator.ts` - ä¼˜å…ˆçº§è®¡ç®—
- `apps/core-app/src/main/modules/download/concurrency-adjuster.ts` - å¹¶å‘è°ƒæ•´
- `apps/core-app/src/renderer/src/components/download/DownloadCenter.vue` - ä¸‹è½½ä¸­å¿ƒç•Œé¢
- `apps/core-app/src/renderer/src/components/download/DownloadTask.vue` - ä¸‹è½½ä»»åŠ¡ç»„ä»¶

### 4.3 IPCé€šé“è®¾è®¡

**ä¸»è¿›ç¨‹é€šé“**ï¼š
- `download:add-task` - æ·»åŠ ä¸‹è½½ä»»åŠ¡
- `download:pause-task` - æš‚åœä»»åŠ¡
- `download:resume-task` - æ¢å¤ä»»åŠ¡
- `download:cancel-task` - å–æ¶ˆä»»åŠ¡
- `download:get-tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `download:get-progress` - è·å–ä¸‹è½½è¿›åº¦
- `download:update-config` - æ›´æ–°é…ç½®

**äº‹ä»¶å¹¿æ’­**ï¼š
- `download:task-added` - ä»»åŠ¡å·²æ·»åŠ 
- `download:task-progress` - ä»»åŠ¡è¿›åº¦æ›´æ–°
- `download:task-completed` - ä»»åŠ¡å®Œæˆ
- `download:task-failed` - ä»»åŠ¡å¤±è´¥
- `download:task-cancelled` - ä»»åŠ¡å–æ¶ˆ

### 4.4 é…ç½®ç®¡ç†

**ä¸‹è½½é…ç½®**ï¼š
```json
{
  "download": {
    "concurrency": {
      "maxConcurrent": 3,
      "autoAdjust": true,
      "networkAware": true,
      "priorityBased": true
    },
    "chunk": {
      "size": 1048576,
      "resume": true,
      "autoRetry": true,
      "maxRetries": 3
    },
    "storage": {
      "tempDir": "/Users/xxx/Downloads/TalexTouch",
      "historyRetention": 30,
      "autoCleanup": true
    }
  }
}
```

## äº”ã€å®‰å…¨è€ƒè™‘

### 5.1 æ–‡ä»¶æ ¡éªŒ
- æ”¯æŒSHA256ã€MD5ç­‰æ ¡éªŒç®—æ³•
- ä¸‹è½½å®Œæˆåè‡ªåŠ¨æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§
- æ ¡éªŒå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æˆ–æç¤ºç”¨æˆ·

### 5.2 æƒé™æ§åˆ¶
- é™åˆ¶ä¸‹è½½ç›®å½•è®¿é—®æƒé™
- é˜²æ­¢è·¯å¾„éå†æ”»å‡»
- ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†

### 5.3 ç½‘ç»œå®‰å…¨
- å¼ºåˆ¶HTTPSä¸‹è½½ï¼ˆå¯é…ç½®ä¾‹å¤–ï¼‰
- æ”¯æŒè‡ªå®šä¹‰è¯·æ±‚å¤´
- é˜²æ­¢æ¶æ„URLæ”»å‡»

## å…­ã€å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¶æ„ï¼ˆ3-4å¤©ï¼‰
- [ ] åˆ›å»ºDownloadCenterä¸»æ¨¡å—
- [ ] å®ç°TaskQueueä¼˜å…ˆçº§é˜Ÿåˆ—
- [ ] è®¾è®¡æ•°æ®åº“Schemaå’ŒDatabaseService
- [ ] å®ç°åŸºç¡€IPCé€šé“

### é˜¶æ®µäºŒï¼šä¸‹è½½å¼•æ“ï¼ˆ4-5å¤©ï¼‰
- [ ] å®ç°DownloadWorkerå¹¶å‘ä¸‹è½½
- [ ] å®ç°ChunkManageråˆ‡ç‰‡ç®¡ç†
- [ ] å®ç°æ–­ç‚¹ç»­ä¼ é€»è¾‘
- [ ] æ·»åŠ æ–‡ä»¶æ ¡éªŒåŠŸèƒ½

### é˜¶æ®µä¸‰ï¼šæ™ºèƒ½è°ƒåº¦ï¼ˆ2-3å¤©ï¼‰
- [ ] å®ç°PriorityCalculator
- [ ] å®ç°ConcurrencyAdjuster
- [ ] å®ç°NetworkMonitor
- [ ] æ·»åŠ åŠ¨æ€ä¼˜å…ˆçº§è°ƒæ•´

### é˜¶æ®µå››ï¼šç”¨æˆ·ç•Œé¢ï¼ˆ3-4å¤©ï¼‰
- [ ] å®ç°DownloadCenter.vueä¸»ç•Œé¢
- [ ] å®ç°DownloadTask.vueä»»åŠ¡ç»„ä»¶
- [ ] æ·»åŠ è®¾ç½®é¡µé¢é›†æˆ
- [ ] å®ç°i18nå›½é™…åŒ–

### é˜¶æ®µäº”ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰
- [ ] é›†æˆæµ‹è¯•ï¼ˆå®Œæ•´ä¸‹è½½æµç¨‹ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¹¶å‘ä¸‹è½½ï¼‰
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

## ä¸ƒã€è¡¡é‡æŒ‡æ ‡

- **ä¸‹è½½æˆåŠŸç‡**ï¼šâ‰¥ 95%ï¼ˆ7 æ—¥å‡å€¼ï¼‰
- **æ–­ç‚¹ç»­ä¼ æˆåŠŸç‡**ï¼šâ‰¥ 90%ï¼ˆä¸­æ–­åæ¢å¤ä¸‹è½½ï¼‰
- **å¹³å‡ä¸‹è½½é€Ÿåº¦**ï¼šâ‰¥ 80% ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡
- **ç”¨æˆ·æ»¡æ„åº¦**ï¼šâ‰¥ 85%ï¼ˆä¸‹è½½ä½“éªŒè¯„åˆ†ï¼‰

## å…«ã€é£é™©ä¸ç¼“è§£

### 8.1 é£é™©è¯†åˆ«
1. **ç£ç›˜ç©ºé—´ä¸è¶³**ï¼šå¤§æ–‡ä»¶ä¸‹è½½å¯èƒ½è€—å°½ç£ç›˜ç©ºé—´
   - ç¼“è§£ï¼šä¸‹è½½å‰æ£€æŸ¥å¯ç”¨ç©ºé—´ï¼Œæä¾›æ¸…ç†å»ºè®®

2. **ç½‘ç»œä¸ç¨³å®š**ï¼šé¢‘ç¹æ–­ç½‘å¯¼è‡´ä¸‹è½½å¤±è´¥
   - ç¼“è§£ï¼šæ™ºèƒ½é‡è¯•æœºåˆ¶ï¼Œç½‘ç»œæ¢å¤è‡ªåŠ¨ç»§ç»­

3. **å¹¶å‘è¿‡å¤š**ï¼šå½±å“ç³»ç»Ÿæ€§èƒ½
   - ç¼“è§£ï¼šåŠ¨æ€è°ƒæ•´å¹¶å‘æ•°ï¼Œç½‘ç»œæ„ŸçŸ¥è°ƒåº¦

### 8.2 å›æ»šæ–¹æ¡ˆ
å¦‚ä¸‹è½½ä¸­å¿ƒå‡ºç°ä¸¥é‡é—®é¢˜ï¼š
- é™çº§åˆ°åŸæœ‰ä¸‹è½½æ–¹å¼
- æä¾›æ‰‹åŠ¨ä¸‹è½½æŒ‡å¼•
- ç´§æ€¥ä¿®å¤å¹¶å‘å¸ƒè¡¥ä¸

## ä¹ã€é™„å½•

### 9.1 ç›¸å…³æ–‡ä»¶æ¸…å•
- `apps/core-app/src/main/modules/plugin/providers/utils.ts` - ç°æœ‰ä¸‹è½½å·¥å…·å‚è€ƒ
- `apps/core-app/src/main/core/channel-core.ts` - IPCé€šé“ç³»ç»Ÿ
- `apps/core-app/src/main/modules/storage/storage-provider.ts` - é…ç½®ç®¡ç†å‚è€ƒ

### 9.2 APIç¤ºä¾‹

**æ·»åŠ ä¸‹è½½ä»»åŠ¡**ï¼š
```typescript
// åº”ç”¨æ›´æ–°ä¸‹è½½
const updateTask = await downloadCenter.addTask({
  url: 'https://github.com/talex-touch/tuff/releases/download/v2.1.0/TalexTouch-2.1.0-win-x64.exe',
  destination: '/Users/xxx/Downloads/',
  filename: 'TalexTouch-2.1.0-win-x64.exe',
  priority: DownloadPriority.NORMAL,
  module: DownloadModule.APP_UPDATE,
  checksum: 'sha256:abcd1234...'
})

// æ’ä»¶å®‰è£…ä¸‹è½½
const pluginTask = await downloadCenter.addTask({
  url: 'https://registry.npmjs.org/@talex-touch/plugin-music/-/plugin-music-1.2.0.tgz',
  destination: '/Users/xxx/.talex-touch/plugins/',
  filename: 'plugin-music-1.2.0.tgz',
  priority: DownloadPriority.HIGH,
  module: DownloadModule.PLUGIN_INSTALL
})
```

### 9.3 é…ç½®ç¤ºä¾‹

**å®Œæ•´ä¸‹è½½é…ç½®**ï¼š
```json
{
  "download": {
    "concurrency": {
      "maxConcurrent": 3,
      "autoAdjust": true,
      "networkAware": true,
      "priorityBased": true
    },
    "chunk": {
      "size": 1048576,
      "resume": true,
      "autoRetry": true,
      "maxRetries": 3
    },
    "storage": {
      "tempDir": "/Users/xxx/Downloads/TalexTouch",
      "historyRetention": 30,
      "autoCleanup": true
    },
    "network": {
      "timeout": 30000,
      "retryDelay": 5000,
      "maxRetries": 3
    }
  }
}
```
