# AGENTS.md (core-app 补充记录)

## 存储与同步规则（core-app 必须遵守）

- SQLite 是本地唯一权威源（SoT）；JSON 只允许作为“同步载荷格式”，且必须密文（如 `payload_enc`/`payload_ref`）。
- `deviceId` 只能做设备标识，不允许直接作为密钥材料；口令/恢复码/密钥等敏感信息本地必须走系统安全存储（优先 Electron `safeStorage` 或等价能力），禁止明文写入 localStorage/JSON/日志。
- 首次引导是否展示必须等待 storage hydration 完成后再判定；启用同步必须先登录。
- 新同步能力只走 `/api/v1/sync/*`（以及 `/api/v1/keys/*`、`/api/v1/devices/*`），禁止新增依赖旧 `/api/sync/*`。

## 全局快捷键需求记录

- 插件全局快捷键权限：sdkapi >= 260121 才要求权限；不阻止注册，但标记为“不安全”并提示原因。
- 插件注册快捷键需提供语义描述（desc）；缺失时同样标记为“不安全”。
- 冲突策略：系统/内置快捷键优先级最高，插件优先级最低；冲突时插件快捷键禁用，交由用户重新映射。
- 展示与修改：系统快捷键在全局设置中展示；插件快捷键在插件信息页（权限页）展示，并提供快速修改入口。
