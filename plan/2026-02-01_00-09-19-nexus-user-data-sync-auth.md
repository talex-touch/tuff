---
mode: plan
cwd: /Users/talexdreamsoul/Workspace/Projects/talex-touch
task: Nexus ç”¨æˆ·æ•°æ®å­˜å‚¨é™åˆ¶ + åŒæ­¥ + E2EE + OAuth/SSO æ–¹æ¡ˆè½åœ°
complexity: complex
planning_method: builtin
created_at: 2026-02-01T00:09:31+08:00
---

# Plan: Nexus ç”¨æˆ·æ•°æ®å­˜å‚¨/åŒæ­¥/è®¤è¯æ–¹æ¡ˆè½åœ°

ğŸ¯ ä»»åŠ¡æ¦‚è¿°
åœ¨ Nexus ä¸­è½åœ°ç”¨æˆ·æ•°æ®å­˜å‚¨é™åˆ¶ã€è·¨è®¾å¤‡åŒæ­¥ï¼ˆå®æ—¶+å®šæ—¶ï¼‰ã€ç«¯åˆ°ç«¯åŠ å¯†ï¼ˆE2EEï¼‰ï¼Œä¸ªäººé˜¶æ®µä¼˜å…ˆ OAuth/OIDC ç™»å½•ï¼Œé¢„ç•™ä¼ä¸šé˜¶æ®µçš„ SSOï¼ˆOIDC/SAML + SCIMï¼‰æ‰©å±•è·¯å¾„ã€‚æ’é™¤ OCR/æ–‡ä»¶ç´¢å¼•ç­‰ä¸å‚ä¸åŒæ­¥çš„æ•°æ®ã€‚

ğŸ“‹ æ‰§è¡Œè®¡åˆ’
1. æ˜ç¡®æ•°æ®èŒƒå›´ä¸ç­–ç•¥ï¼šåˆ—å‡ºéœ€è¦åŒæ­¥çš„æ•°æ®ç±»å‹ã€æ’é™¤é¡¹ä¸åŒæ­¥ç­–ç•¥ï¼ˆå®æ—¶/å®šæ—¶/ä¸åŒæ­¥ï¼‰ï¼Œå¹¶ç»™å‡ºä¸ªäººé˜¶æ®µçš„é»˜è®¤é…é¢ä¸é™åˆ¶ä¸Šé™ã€‚
2. è®¾è®¡æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼šå®šä¹‰ items/oplog/blobs/keyrings/users/devices/quotas ç­‰è¡¨ç»“æ„ä¸ç´¢å¼•ç­–ç•¥ï¼Œç¡®å®šæœ¬åœ°ä¸æœåŠ¡ç«¯çš„å­˜å‚¨èŒè´£è¾¹ç•Œã€‚
3. è®¾è®¡ E2EE å¯†é’¥ä½“ç³»ï¼šä¸»å¯†é’¥ã€è®¾å¤‡å¯†é’¥ã€æ•°æ®å¯†é’¥å±‚çº§ï¼Œå¯†é’¥æ¢å¤ä¸è½®æ¢ç­–ç•¥ï¼Œå…ƒæ•°æ®æ˜¯å¦æ˜æ–‡å¯ç”¨çš„å…·ä½“å­—æ®µæ¸…å•ã€‚
4. è®¾è®¡åŒæ­¥åè®®ï¼šhandshakeã€push/pullã€cursor æœºåˆ¶ã€LWW å†²çªç­–ç•¥ã€æ–­ç‚¹ç»­ä¼ ï¼›å®šä¹‰å®æ—¶é€šé“ï¼ˆWSï¼‰+ å®šæ—¶å¯¹è´¦ï¼ˆPollingServiceï¼‰ååŒé€»è¾‘ã€‚
5. è®¤è¯æ–¹æ¡ˆç»†åŒ–ï¼šOAuth/OIDCï¼ˆPKCEï¼‰æµç¨‹ã€å¤šè´¦å·ç»‘å®šã€è®¾å¤‡ä¸Šé™æ ¡éªŒï¼›é¢„ç•™ä¼ä¸šæ‰©å±•çš„ OIDC/SAML/SCIM æ¥å£ä¸é…ç½®ç»“æ„ã€‚
6. é…é¢ä¸é™åˆ¶æ‰§è¡Œï¼šæœåŠ¡ç«¯å†™å…¥å‰å¼ºåˆ¶æ ¡éªŒã€å®¢æˆ·ç«¯æç¤ºä¸é™çº§ï¼ˆåªè¯»/æœ¬åœ°ä¿å­˜ï¼‰ï¼Œå®šä¹‰è¶…é™é”™è¯¯ç ä¸æ¢å¤ç­–ç•¥ã€‚
7. API ä¸é”™è¯¯è§„èŒƒï¼šè¡¥é½è®¤è¯ã€åŒæ­¥ã€é…é¢ã€å¯†é’¥ç›¸å…³æ¥å£ä¸é”™è¯¯ç ï¼Œå½¢æˆå¯¹å¤– API æ–‡æ¡£è‰æ¡ˆä¸ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ã€‚
8. å®¢æˆ·ç«¯é›†æˆæ–¹æ¡ˆï¼šæœ¬åœ°æ•°æ®åº“ä¸ oplog å†™å…¥é“¾è·¯ã€åŠ è§£å¯†æµç¨‹ã€åŒæ­¥è°ƒåº¦å™¨æ¥å…¥ã€å†å²æœ¬åœ°æ•°æ®çš„è¿ç§»ç­–ç•¥ã€‚
9. æµ‹è¯•ä¸å›å½’ï¼šå•å…ƒæµ‹è¯•ï¼ˆåŠ è§£å¯†/å†²çª/LWWï¼‰ã€é›†æˆæµ‹è¯•ï¼ˆå¤šè®¾å¤‡åŒæ­¥/æ–­ç½‘æ¢å¤/é™é¢ï¼‰ã€å®‰å…¨æµ‹è¯•ï¼ˆå¯†é’¥ä¸¢å¤±/é‡æ”¾ï¼‰ã€‚
10. è§‚æµ‹ä¸å‘å¸ƒï¼šæ—¥å¿—æŒ‡æ ‡ï¼ˆåŒæ­¥æˆåŠŸç‡/å»¶è¿Ÿ/å†²çªç‡ï¼‰ã€ç°åº¦å¼€å…³ï¼ˆåŒæ­¥/å®æ—¶/E2EE ç‹¬ç«‹å¼€å…³ï¼‰ã€å›æ»šç­–ç•¥ï¼ˆé™çº§ä¸ºæœ¬åœ°-onlyï¼‰ã€‚

## æ•°æ®èŒƒå›´ä¸åŒæ­¥ç­–ç•¥

### åŒæ­¥æ•°æ®ç±»å‹ä¸ç­–ç•¥
| æ•°æ®ç±»å‹ | ç¤ºä¾‹ | åŒæ­¥ç­–ç•¥ | å¤‡æ³¨ |
| --- | --- | --- | --- |
| è´¦å·ä¸è®¢é˜…å…ƒæ•°æ® | ç”¨æˆ· profileã€è®¢é˜…è®¡åˆ’ã€é…é¢è¯»æ•° | å®šæ—¶æ‹‰å– | æœåŠ¡ç«¯æƒå¨ï¼Œå®¢æˆ·ç«¯ä¸å†™å…¥ |
| è®¾å¤‡æ¸…å•ä¸ä¼šè¯ä¿¡æ¯ | è®¾å¤‡åç§°ã€æœ€è¿‘æ´»è·ƒã€ä¼šè¯å…ƒä¿¡æ¯ | å®æ—¶ | ç”¨äºç™»å½•æ€ä¸å®‰å…¨å®¡è®¡ |
| æ ¸å¿ƒç»“æ„åŒ–æ•°æ® | items/oplogã€æ”¶è—/å¿«æ·åŠ¨ä½œ/æµç¨‹ | å®æ—¶ | å°ç²’åº¦å˜æ›´å³æ¨é€ |
| ç”¨æˆ·åå¥½ä¸è®¾ç½® | ä¸»é¢˜ã€å¸ƒå±€ã€å¿«æ·é”®ã€åŠŸèƒ½å¼€å…³ | å®æ—¶ | é»˜è®¤åˆå¹¶ç­–ç•¥ LWW |
| æ’ä»¶ä¸æ‰©å±•é…ç½® | æ’ä»¶å¯ç”¨çŠ¶æ€ã€æ’ä»¶é…ç½®é¡¹ | å®šæ—¶ | ä½é¢‘å˜æ›´ï¼Œé¿å…é¢‘ç¹å†™å…¥ |
| ä½¿ç”¨å†å² | æœç´¢å†å²ã€æœ€è¿‘ä½¿ç”¨åˆ—è¡¨ | å®šæ—¶ | ä¿ç•™çª—å£å¯é…ç½®ï¼ˆé»˜è®¤ 30 å¤©ï¼‰ |
| è¿è¡Œæ—¶ç¼“å­˜ | OCR ç»“æœã€æ–‡ä»¶ç´¢å¼•ã€å…¨æ–‡ç´¢å¼• | ä¸åŒæ­¥ | å¯é‡å»ºã€ä½“é‡å¤§ï¼Œæ˜ç¡®æ’é™¤ |
| æ—¥å¿—ä¸ä¸´æ—¶æ•°æ® | è¯Šæ–­æ—¥å¿—ã€å´©æºƒè½¬å‚¨ã€ä¸´æ—¶å¯¼å‡º | ä¸åŒæ­¥ | ä»…æœ¬åœ°ä¿ç•™ |

### é»˜è®¤é…é¢ï¼ˆä¸ªäººé˜¶æ®µï¼‰
- æ€»å®¹é‡ï¼š1 GBï¼ˆitems + blobs + oplog æ±‡æ€»ï¼‰
- å¯¹è±¡æ•°ï¼š50,000ï¼ˆitems/oplog é€»è¾‘å¯¹è±¡ï¼‰
- å•æ¡å¤§å°ï¼š5 MBï¼ˆå•å¯¹è±¡/å• blob ä¸Šé™ï¼Œè¶…å‡ºéœ€åˆ†ç‰‡ï¼‰
- è®¾å¤‡æ•°ï¼š3 å°ï¼ˆè¶…è¿‡éœ€è§£ç»‘æˆ–å‡çº§ï¼‰

## æ ¸å¿ƒæ•°æ®æ¨¡å‹è®¾è®¡

### èŒè´£è¾¹ç•Œ
- æœ¬åœ°ï¼šitems/oplog å†™å…¥ä¸ç¦»çº¿ç¼“å­˜ï¼›payload åŠ å¯†åè½ç›˜ï¼›blob æœ¬åœ°ç¼“å­˜å¯æ¸…ç†ã€‚
- æœåŠ¡ç«¯ï¼šusers/devices/quotas æƒå¨ï¼›items/oplog/blobs ä½œä¸ºåŒæ­¥æºï¼›keyrings ä»…ä¿å­˜åŠ å¯†ææ–™ä¸æ¢å¤ç æ‘˜è¦ã€‚

### è¡¨ç»“æ„è‰æ¡ˆ

#### users
å­—æ®µï¼šid(uuid, PK)ï¼Œaccount_id(string, UNIQUE)ï¼Œplan(string)ï¼Œstatus(string)ï¼Œcreated_at(timestamp)
ç´¢å¼•/çº¦æŸï¼šUNIQUE(account_id)

#### devices
å­—æ®µï¼šid(uuid, PK)ï¼Œuser_id(uuid)ï¼Œfingerprint(string)ï¼Œname(string)ï¼Œplatform(string)ï¼Œlast_seen_at(timestamp)ï¼Œstatus(string)
ç´¢å¼•/çº¦æŸï¼šUNIQUE(user_id, fingerprint)ï¼ŒINDEX(user_id, last_seen_at)

#### quotas
å­—æ®µï¼šid(uuid, PK)ï¼Œuser_id(uuid)ï¼Œstorage_limit_bytes(int)ï¼Œobject_limit(int)ï¼Œitem_limit(int)ï¼Œdevice_limit(int)ï¼Œused_storage_bytes(int)ï¼Œused_objects(int)ï¼Œused_devices(int)ï¼Œupdated_at(timestamp)
ç´¢å¼•/çº¦æŸï¼šUNIQUE(user_id)

#### items
å­—æ®µï¼šid(uuid, PK)ï¼Œuser_id(uuid)ï¼Œdevice_id(uuid)ï¼Œtype(string)ï¼Œschema_version(int)ï¼Œpayload_enc(blob_ref)ï¼Œmeta_plain(json)ï¼Œupdated_at(timestamp)ï¼Œdeleted_at(timestamp)
ç´¢å¼•/çº¦æŸï¼šINDEX(user_id, updated_at)ï¼ŒINDEX(user_id, type)

#### oplog
å­—æ®µï¼šid(uuid, PK)ï¼Œuser_id(uuid)ï¼Œdevice_id(uuid)ï¼Œitem_id(uuid)ï¼Œop_type(string)ï¼Œop_seq(int)ï¼Œop_hash(string)ï¼Œcreated_at(timestamp)
ç´¢å¼•/çº¦æŸï¼šUNIQUE(user_id, device_id, op_seq)ï¼ŒINDEX(user_id, created_at)

#### blobs
å­—æ®µï¼šid(uuid, PK)ï¼Œuser_id(uuid)ï¼Œobject_key(string)ï¼Œsha256(string)ï¼Œsize_bytes(int)ï¼Œcontent_type(string)ï¼Œcreated_at(timestamp)ï¼Œstatus(string)
ç´¢å¼•/çº¦æŸï¼šUNIQUE(user_id, object_key)ï¼ŒINDEX(user_id, sha256)

#### keyrings
å­—æ®µï¼šid(uuid, PK)ï¼Œuser_id(uuid)ï¼Œdevice_id(uuid)ï¼Œkey_type(string)ï¼Œencrypted_key(blob)ï¼Œrecovery_code_hash(string)ï¼Œrotated_at(timestamp)ï¼Œcreated_at(timestamp)
ç´¢å¼•/çº¦æŸï¼šUNIQUE(user_id, device_id, key_type)ï¼ŒINDEX(user_id, key_type)

âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹
- E2EE å¸¦æ¥å¯†é’¥ä¸¢å¤±ä¸å¯æ¢å¤é£é™©ï¼Œéœ€è¦å¼ºåˆ¶æ¢å¤ç ä¸å¤šè®¾å¤‡å†—ä½™æœºåˆ¶ã€‚
- å®æ—¶åŒæ­¥ä¸å®šæ—¶å¯¹è´¦å¯èƒ½å¯¼è‡´é‡å¤å†™å…¥æˆ–å†²çªæ‰©å¤§ï¼Œéœ€ä¸¥æ ¼ cursor ä¸å¹‚ç­‰æ§åˆ¶ã€‚
- é…é¢é™åˆ¶å¯èƒ½é€ æˆç”¨æˆ·æ•°æ®å†™å…¥å¤±è´¥ï¼Œéœ€æ¸…æ™° UI æç¤ºä¸å‡çº§å¼•å¯¼ã€‚
- æœªæ¥ä¼ä¸šç‰ˆ SSO/SCIM éœ€è¦é¢å¤–åˆè§„ä¸å®‰å…¨è¯„å®¡ï¼Œéœ€æå‰é¢„ç•™æ‰©å±•ç‚¹ã€‚

ğŸ“ å‚è€ƒ
- docs/engineering/monorepo-standards.md
