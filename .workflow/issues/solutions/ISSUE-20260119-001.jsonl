{"id":"SOL-ISSUE-20260119-001-1","description":"为剪贴板内容增加可查询的标签体系（来源应用、URL、API Key、账号/密码等），并把标签用于 CoreBox 上下文展示与快速匹配。","approach":"在主进程剪贴板采集阶段进行轻量规则匹配并写入 meta 与 clipboard_history_meta；扩展传输类型携带 tags；渲染层展示标签并保留元数据序列化用于搜索/上下文。","tasks":[{"id":"T1","action":"Add","title":"剪贴板标签识别与持久化","implementation":["新增 apps/core-app/src/main/modules/clipboard/clipboard-tagging.ts，提供 detectClipboardTags()，覆盖 URL、API Key、账号/密码、Email 等模式，输出规范化 tags（不包含原始敏感值）。","在 apps/core-app/src/main/modules/clipboard.ts 的采集流程中调用 detectClipboardTags，合并到 metaEntries 与 metaObject.tags，并为每个 tag 追加单独 meta 记录（key=tag,value=tag）。","新增 apps/core-app/src/main/modules/clipboard/clipboard-tagging.test.ts，使用 vitest 覆盖 URL/API Key/账号密码/邮箱等典型与边界样例。"],"modification_points":[{"file":"apps/core-app/src/main/modules/clipboard/clipboard-tagging.ts","reason":"实现剪贴板标签识别逻辑与规则集合。"},{"file":"apps/core-app/src/main/modules/clipboard.ts","reason":"采集阶段生成 tags 并持久化到 meta 与 meta 表。"},{"file":"apps/core-app/src/main/modules/clipboard/clipboard-tagging.test.ts","reason":"为标签识别逻辑补充单元测试与边界验证。"}],"test":{"commands":["pnpm -C \"apps/core-app\" exec vitest \"src/main/modules/clipboard/clipboard-tagging.test.ts\""]},"acceptance":{"criteria":["URL 文本条目生成 tags 包含 url，并在 clipboard_history_meta 中存在 key=tag,value=\"url\" 记录。","识别到 API Key 模式时生成 tags 包含 api_key，tags 不包含原始 key 内容。","包含账号/密码字段的文本生成 tags 包含 account 或 password。","tags 同时写入 meta.tags 数组以便前端展示与查询。"],"verification":["运行 pnpm -C \"apps/core-app\" exec vitest \"src/main/modules/clipboard/clipboard-tagging.test.ts\"。","在开发模式复制示例文本后，通过 clipboard:query + metaFilter(key=tag,value=url) 验证可命中最新条目。"]}},{"id":"T2","action":"Update","title":"传输与序列化支持 tags","depends_on":["T1"],"implementation":["扩展 packages/utils/transport/events/types/clipboard.ts 中 ClipboardItem，新增 tags?: string[]（必要时补充 meta?: Record<string, unknown>）。","在 apps/core-app/src/main/modules/clipboard.ts 的 toTransportItem 中填充 tags（来自 meta.tags），并确保 change stream 与 getHistory 响应携带 tags。","更新 apps/core-app/src/renderer/src/modules/box/adapter/hooks/useClipboardChannel.ts 的 convertClipboardItem，将 tags 写回 IClipboardItem.meta.tags。","调整 apps/core-app/src/renderer/src/modules/box/adapter/hooks/useClipboardState.ts 的 safeSerializeMetadata，允许 string[] tags 被序列化并随 QueryInputs 传递。"],"modification_points":[{"file":"packages/utils/transport/events/types/clipboard.ts","reason":"为 ClipboardItem 增加 tags 字段。"},{"file":"apps/core-app/src/main/modules/clipboard.ts","reason":"在 transport 转换时下发 tags。"},{"file":"apps/core-app/src/renderer/src/modules/box/adapter/hooks/useClipboardChannel.ts","reason":"将 tags 映射到 renderer 侧的 meta。"},{"file":"apps/core-app/src/renderer/src/modules/box/adapter/hooks/useClipboardState.ts","reason":"允许 tags 数组进入 metadata。"}],"test":{"commands":["pnpm -C \"apps/core-app\" run typecheck"]},"acceptance":{"criteria":["Clipboard change stream 在 renderer 侧可读到 clipboardOptions.last.meta.tags。","safeSerializeMetadata 不再丢弃 string[] tags。","类型检查通过（无新增 TS 报错）。"],"verification":["运行 pnpm -C \"apps/core-app\" run typecheck。","复制 URL 文本后在 CoreBox 观察 clipboardOptions.last.meta.tags 有值（开发调试）。"]}},{"id":"T3","action":"Update","title":"CoreBox 标签展示","depends_on":["T2"],"implementation":["在 apps/core-app/src/renderer/src/views/box/tag/TagSection.vue 增加 clipboard tags 展示区域，最多展示 3 个标签并显示剩余数量。","将 sourceApp 或 meta 中的来源信息映射为展示标签（如 From: <App>），并保持无 tags 时 UI 不变。","如需本地化，补充 apps/core-app/src/renderer/src/modules/lang/zh-CN.json 与 en-US.json 对应标签文案。"],"modification_points":[{"file":"apps/core-app/src/renderer/src/views/box/tag/TagSection.vue","reason":"在 CoreBox Tag 区域展示 clipboard tags。"},{"file":"apps/core-app/src/renderer/src/modules/lang/zh-CN.json","reason":"可选：新增标签展示文案。"},{"file":"apps/core-app/src/renderer/src/modules/lang/en-US.json","reason":"可选：新增标签展示文案。"}],"test":{"commands":["pnpm -C \"apps/core-app\" run typecheck:web"]},"acceptance":{"criteria":["存在 tags 时，TagSection 展示最多 3 个标签并显示溢出计数。","无 tags 时现有 Tag UI 保持不变。","渲染端模板/TS 类型检查通过。"],"verification":["运行 pnpm -C \"apps/core-app\" run typecheck:web。","复制 URL 或 API Key 文本后在 CoreBox 观察标签展示效果（手动验证）。"]}}],"is_bound":true,"created_at":"2026-01-19T11:41:15.772Z","bound_at":"2026-01-19T11:41:21.349Z"}
