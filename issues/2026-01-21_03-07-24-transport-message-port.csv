id,priority,phase,area,title,description,acceptance_criteria,test_mcp,review_initial_requirements,review_regression_requirements,dev_state,review_initial_state,review_regression_state,git_state,owner,refs,notes
TPORT-010,P1,1,both,盘点现有流式与高频链路,梳理 transport 当前流式实现与高频通道，明确端口升级范围与保留 channel 的边界。,输出可迁移清单与分级（高频/流式/大 payload），并标注保留 invoke/channel 的理由。,AUTOE2E,覆盖剪贴板/CoreBox/推荐/文件索引/AI 回复链路；不引入实现细节。,清单与计划一致，未遗漏核心链路。,未开始,未开始,未开始,未提交,,plan/2026-01-21_03-01-57-transport-message-port.md:16;packages/utils/transport/sdk/renderer-transport.ts:370,
TPORT-020,P0,2,both,设计端口升级协议与事件类型,定义 MessagePort 升级/确认/关闭/错误的事件与 payload envelope。,在 transport 事件/类型中新增定义并通过类型检查；字段覆盖升级、关闭、错误与端口绑定范围。,AUTOSERVER,保证兼容旧 channel；明确权限/绑定范围；不引入敏感字段。,类型变更不破坏现有事件编译；新增事件有说明。,已完成,已完成,已完成,已提交,,plan/2026-01-21_03-01-57-transport-message-port.md:17;packages/utils/transport/events/index.ts:2410;packages/utils/transport/events/types/transport.ts:14;packages/utils/transport/events/types/index.ts:64,"picked_reason:protocol-first-to-unblock-backend-frontend;validation_limited:pnpm utils:test failed (missing @tuff/utils/aisdk, @talex-touch/utils/help/tree-generator; other suite issues);manual_test:pnpm utils:test;evidence:added transport port event definitions and types;risk:low types-only change;done_at:2026-01-21T03:36:31+0800;blocked:git commit failed (commitlint subject/type empty);commit_retry:use-conventional-commit-message"
TPORT-030,P0,3,backend,主进程端口管理与生命周期,主进程创建/分发 MessagePortMain 并维护端口回收。,可通过 postMessage 下发端口；窗口销毁/close 会回收；端口异常自动降级到 channel。,AUTOSERVER,端口与窗口/插件绑定正确；有回收与超时策略；错误日志清晰。,关闭窗口/重载后端口被回收；无未处理异常。,已完成,已完成,已完成,已提交,,plan/2026-01-21_03-01-57-transport-message-port.md:18;packages/utils/transport/sdk/main-transport.ts:91;packages/utils/transport/sdk/main-transport.ts:326,"picked_reason:backend-port-management-after-protocol;validation_limited:pnpm utils:test failed (missing @tuff/utils/aisdk, @talex-touch/utils/help/tree-generator; other suite issues);manual_test:pnpm utils:test;evidence:registered MessagePort upgrade/confirm/close/error handlers with lifecycle cleanup;risk:medium new port registry and timeouts in main transport;done_at:2026-01-21T08:13:15+0800"
TPORT-040,P0,4,frontend,渲染进程端口层与 upgrade API,新增 transport.upgrade/openPort 并让 stream 优先走端口。,renderer 可建立端口并收发消息；端口不可用时回退 channel；不影响现有 send/invoke。,AUTOFRONTEND,端口缓存策略明确；回退路径可观测；不引入阻塞。,stream 保持可用，端口异常自动降级。,未开始,未开始,未开始,未提交,,plan/2026-01-21_03-01-57-transport-message-port.md:19;packages/utils/transport/sdk/renderer-transport.ts:370,
TPORT-050,P1,5,both,错误处理与回退策略统一,统一端口不可用/断开/隔离限制的降级与日志。,端口异常时自动回退并记录关键日志；不阻塞主流程。,AUTOE2E,错误码/日志不泄露敏感信息；回退路径清晰。,模拟端口关闭/失败时功能不崩溃且可回退。,未开始,未开始,未开始,未提交,,plan/2026-01-21_03-01-57-transport-message-port.md:20;packages/utils/transport/sdk/renderer-transport.ts:370,
TPORT-060,P1,6,both,迁移首批高频通道到端口,剪贴板、CoreBox 推送、推荐、文件索引、AI 回复流优先走端口。,以上通道在端口可用时使用端口；不可用时回退；具备开关与回滚点。,AUTOE2E,逐项迁移有回滚开关；不改变业务语义。,高频链路无丢消息/乱序；回退仍可用。,未开始,未开始,未开始,未提交,,plan/2026-01-21_03-01-57-transport-message-port.md:21;apps/core-app/src/main/modules/clipboard.ts:1606;apps/core-app/src/main/modules/box-tool/core-box/window.ts:573,
TPORT-070,P1,7,both,插件与多窗口/隔离适配,插件 UI 与多窗口场景建立端口桥接或自动回退。,插件 UI 可获取端口或自动回退；多窗口不冲突；隔离模式可用。,AUTOE2E,隔离模式兼容；权限边界明确；端口清理可追踪。,插件重载/窗口销毁后端口清理，功能可恢复。,未开始,未开始,未开始,未提交,,plan/2026-01-21_03-01-57-transport-message-port.md:22;apps/core-app/src/main/modules/box-tool/core-box/window.ts:948,
TPORT-080,P2,8,both,验证与文档补充,执行类型检查/冒烟验证并补充 Nexus 文档。,类型检查与冒烟验证通过；文档说明升级协议、回退行为与示例。,AUTOE2E,文档覆盖新 API 与限制；示例可复现。,实现与文档一致；回归无明显行为变化。,未开始,未开始,未开始,未提交,,plan/2026-01-21_03-01-57-transport-message-port.md:23;packages/utils/transport/events/index.ts:11,
