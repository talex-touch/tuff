id,priority,phase,area,title,description,acceptance_criteria,test_mcp,review_initial_requirements,review_regression_requirements,dev_state,review_initial_state,review_regression_state,git_state,owner,refs,notes
"NEXUS-010","P0","1","both","数据范围与同步策略","定义同步/不同步数据范围与策略，明确个人阶段默认配额与限制。","形成数据类型清单与同步策略表；明确不同步项（含 OCR/文件索引）；给出默认配额（容量/对象数/单条大小/设备数）；评审通过。","AUTOSERVER","范围是否覆盖现有模块；排除项明确且可执行；配额与个人阶段一致。","后续设计/实现必须遵循清单与配额；新增类型需补充评审。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:27","picked_reason:P0前置范围定义，影响后续所有条目;review_initial:覆盖模块/排除项/配额检查通过;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增数据范围与同步策略表+默认配额;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-020","P0","2","both","核心数据模型设计","定义 items/oplog/blobs/keyrings/users/devices/quotas 的表结构与索引，明确本地与服务端职责边界。","完成核心表结构草案（items/oplog/blobs/keyrings/users/devices/quotas）；定义主键/索引/唯一约束；明确本地与服务端职责边界；评审通过。","AUTOSERVER","模型满足查询/同步需求；索引覆盖主访问路径；不破坏现有数据。","后续实现字段与约束保持一致；迁移脚本与模型一致。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:47","picked_reason:P0核心数据模型是后续协议与实现基础;review_initial:表结构覆盖 items/oplog/blobs/keyrings/users/devices/quotas，索引与唯一约束齐备;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增核心数据模型结构与职责边界;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-030","P0","3","both","E2EE 密钥体系","设计主密钥/设备密钥/数据密钥层级与恢复、轮换策略，明确可明文元数据范围。","定义主密钥/设备密钥/数据密钥层级；恢复码与轮换流程；明文元数据字段清单；安全评审通过。","AUTOE2E","密钥不出端；恢复与轮换无单点；元数据明文最小化。","多设备/重装场景仍可恢复；加解密流程稳定。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:83","picked_reason:P0安全前置，影响同步协议与模型;review_initial:密钥层级/恢复/轮换/明文清单齐备且最小化;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增 E2EE 密钥体系与明文元数据清单;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-040","P0","4","both","同步协议与冲突策略","定义 handshake/push/pull/cursor/LWW 与幂等规则，明确 WS + Polling 协作。","同步协议文档包含 handshake/push/pull/cursor/LWW/幂等；定义断点续传与冲突处理；给出 WS+Polling 协作序列。","AUTOE2E","保证幂等与顺序一致性；断网恢复路径清晰；LWW 可解释。","多设备并发写入无数据丢失；重复包不产生重复应用。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:99","picked_reason:P0协议定义影响后续实现与回归;review_initial:handshake/push/pull/cursor/LWW/幂等与协作序列齐备;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增同步协议流程与冲突策略;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-050","P1","5","both","OAuth/OIDC 与 SSO 扩展","细化 OAuth/OIDC（PKCE）流程、多账号绑定与设备上限，并预留企业 SSO/SCIM 扩展。","OAuth/OIDC PKCE 流程文档；多账号绑定规则；设备上限校验点；企业扩展配置结构（OIDC/SAML/SCIM）。","AUTOSERVER","最小权限 scopes；token 刷新/过期策略；个人阶段不引入企业依赖。","多提供商绑定/解绑稳定；超限设备被正确阻断。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:116","picked_reason:P1认证与扩展需要在协议后明确;review_initial:PKCE流程/账号绑定/设备上限/企业扩展结构齐备;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增 OAuth/OIDC 与 SSO 扩展策略;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-060","P1","6","both","配额限制执行","定义服务端写入强校验与客户端降级策略，完善超限错误码与恢复路径。","服务端写入前强制校验规则与错误码；客户端超限降级流程（只读/本地保存）定义；恢复路径说明。","AUTOSERVER","错误码可区分容量/对象/单条/设备；降级不丢数据。","超限与恢复边界场景验证；无越权写入。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:137","picked_reason:P1配额执行依赖前述范围与模型;review_initial:错误码覆盖容量/对象/单条/设备且降级不丢数据;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增配额校验与降级恢复路径;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-070","P1","7","backend","API 与错误码规范","补齐认证/同步/配额/密钥接口与错误码，形成版本化 API 草案。","输出认证/同步/配额/密钥 API 列表及请求响应示例；定义错误码与版本策略；评审通过。","AUTOSERVER","接口命名一致；错误码覆盖关键失败路径。","后续实现接口不偏离文档；版本兼容策略可执行。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:152","picked_reason:P1接口规范承接前述策略;review_initial:接口命名一致且错误码覆盖认证/同步/配额/密钥;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增 API 列表与错误码/版本策略;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-080","P1","8","frontend","客户端集成与迁移","明确本地 oplog 写入与加解密链路、同步调度器接入点与迁移方案。","明确本地 oplog 写入链路与加解密流程；同步调度器接入点；历史数据迁移步骤与回滚。","AUTOFRONTEND","与现有模块集成点清晰；不影响非同步数据。","迁移支持回退；旧数据可正常读取。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:176","picked_reason:P1客户端落地需要明确接入与迁移;review_initial:链路/接入点/迁移回滚齐备且不影响非同步数据;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增客户端集成与迁移方案;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-090","P1","9","both","测试与回归方案","定义单测/集成/安全测试清单与覆盖范围，明确测试执行器。","给出单测/集成/安全测试清单与覆盖范围；明确使用的测试执行器与触发条件。","AUTOE2E","测试覆盖关键路径（加解密/冲突/LWW/断网）。","多设备并发与限额场景全链路回归。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:192","picked_reason:P1测试回归需要在接口与客户端方案后收敛;review_initial:单测/集成/安全覆盖关键路径;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增测试与回归方案;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-100","P2","10","both","观测与发布策略","定义核心指标、灰度开关与回滚策略，保障可观测与可降级。","定义核心指标（成功率/延迟/冲突率）；灰度开关清单；回滚策略（本地-only）。","AUTOSERVER","指标可采集且可告警；开关支持分级。","灰度与回滚流程演练通过。","已完成","已完成","已完成","已提交","","plan/2026-02-01_00-09-19-nexus-user-data-sync-auth.md:210","picked_reason:P2收尾项，依赖前述方案;review_initial:指标/开关/回滚策略完整且可执行;review_regression:文档变更无需回归;validation_limited:doc-only change，未运行测试;manual_test:不适用;evidence:plan 文档新增观测与发布策略;risk:low 文档更新;done_at:2026-02-04"
"NEXUS-110","P0","11","backend","Sync V1 OpenAPI + Backend Skeleton","Implement Sync V1 /api/v1 endpoints with OpenAPI 3.1, generated TS types, D1/R2 store, quota enforcement, and error codes; keep legacy /api/sync unchanged.","OpenAPI spec and TS types generated; D1 schema creation for sync_items_v1/oplog/blobs/keyrings/quotas/sessions; /api/v1 sync/quotas/keys endpoints respond per spec; device/quota checks enforced; legacy /api/sync remains unaffected.","AUTOSERVER","Handlers align with OpenAPI types; schema creation is idempotent; LWW + idempotency enforced; error codes surfaced for invalid payload/quota.","Legacy /api/sync paths remain unchanged; auth/device checks do not regress existing flows; x-device-id required for v1 routes.","已完成","已完成","已完成","已提交","","apps/nexus/server/utils/syncStoreV1.ts:1","picked_reason:Implementing approved Sync V1 contract and backend skeleton;review_initial:OpenAPI spec + generated types match handlers; schema creation idempotent; LWW + idempotency applied in push;review_regression:Legacy /api/sync untouched; v1 routes enforce x-device-id;validation_limited:pnpm -C apps/nexus typecheck failed due to pre-existing project type errors (Nuxt auth/session typing, landing components, utils types);manual_test:pnpm -C apps/nexus typecheck (rerun after existing type errors fixed);evidence:openapi/nexus-sync.yaml + types/sync-api.d.ts + v1 handlers + syncStoreV1 + syncErrors;risk:medium existing typecheck failures and no runtime tests;done_at:2026-02-04"
"NEXUS-120","P1","12","both","Nexus Typecheck Baseline Cleanup","Fix TypeScript errors reported by `pnpm -C \"apps/nexus\" typecheck` so the Nexus typecheck completes successfully.","`pnpm -C \"apps/nexus\" typecheck` finishes without TS errors; fixes are limited to type safety and do not change runtime logic.","AUTOSERVER","Type fixes do not change runtime behavior; scope is limited to reported type errors; no unsafe broad `any` usage.","Typecheck passes after changes; no regression to lint-staged or existing flows.","已完成","已完成","已完成","已提交","","apps/nexus/app/app.vue:17","picked_reason:User requested fixing typecheck errors before adding tests;review_initial:Type safety fixes scoped to reported errors;review_regression:pnpm -C \"apps/nexus\" typecheck passed;evidence:nuxt typecheck completed without TS errors;done_at:2026-02-04"
"NEXUS-130","P1","13","backend","Sync V1 Tests","Add unit and minimal integration tests for Sync V1 store and handlers.","Unit tests cover idempotency, LWW, and quota errors; minimal integration test for handshake->push->pull and blob upload if feasible; tests run or validation-limited notes recorded.","AUTOSERVER","Tests target syncStoreV1 logic and v1 handlers per spec; no brittle fixtures.","Existing tests still pass or validation-limited notes recorded.","已完成","已完成","已完成","已提交","","apps/nexus/server/utils/__tests__/syncStoreV1.test.ts:1","picked_reason:User requested adding tests after typecheck is fixed;review_initial:Unit tests cover idempotency/LWW/quota and minimal flow;review_regression:pnpm -C \"apps/nexus\" test passed;evidence:vitest run for syncStoreV1 tests;done_at:2026-02-04"
"NEXUS-140","P1","14","both","Sync V1 完善度补齐 + CloudSyncSDK","补齐 Sync V1 token 校验、配额精确 delta、push 设备注册，并引入 CloudSyncSDK 与 Dev Extensions 文档。","push/pull/blobs 强制 x-sync-token；配额 delta 精确计数且可回退；push 前设备注册；CloudSyncSDK 支持 handshake/push/pull/upload/quotas/keys 且自动维护 sync_token；dev extensions 文档补齐中英文。","AUTOSERVER","token 校验与配额逻辑一致；SDK 接口与 OpenAPI 对齐；错误码透传；文档覆盖使用示例。","Legacy /api/sync 不受影响；SDK 兼容 renderer/node；新增文档不破坏现有目录结构。","已完成","已完成","已完成","已提交","","apps/nexus/server/utils/syncStoreV1.ts:1;packages/utils/cloud-sync/cloud-sync-sdk.ts:1;apps/nexus/content/docs/dev/extensions/cloud-sync.en.mdc:1","picked_reason:补齐 Sync V1 完善度与客户端 SDK 以便后续接入;review_initial:token 校验/配额 delta/设备注册/SDK API/文档检查通过;review_regression:旧 /api/sync 未改动且 v1 token 仅影响新接口;evidence:pnpm -C apps/nexus run test; pnpm -C packages/utils run test;risk:low 仅新增逻辑与文档;done_at:2026-02-05"
"NEXUS-150","P1","15","both","CloudSync SDK 易用封装与示例扩充","基于 CloudSyncSDK 提供插件友好封装，token/设备由 AccountSDK 提供；SDK 导出路径统一，并补充多场景使用示例。","插件可直接使用 CloudSync SDK 无需传入 auth/device token；AccountSDK 新增获取 auth token/device id 能力；SDK 目录统一导出并保留兼容；文档补充插件/Node/错误处理示例。","AUTOSERVER","插件无需自行处理 token；SDK 入口清晰；兼容既有 CloudSyncSDK。","现有 CloudSyncSDK 用法不回归；文档结构不破坏现有导航。","已完成","已完成","已完成","已提交","","packages/utils/plugin/sdk/cloud-sync.ts:1;packages/utils/account/account-sdk.ts:63;apps/nexus/content/docs/dev/extensions/cloud-sync.en.mdc:1;apps/nexus/content/docs/dev/api/account.en.mdc:1","picked_reason:用户要求降低插件接入成本并扩充示例;review_initial:AccountSDK 增加 token/device 能力且插件 SDK 封装清晰;review_regression:旧 CloudSyncSDK 仍可用，文档仅新增示例;evidence:pnpm -C \"packages/utils\" run test;risk:low SDK 封装与文档调整;done_at:2026-02-05"
"NEXUS-160","P1","16","both","AccountSDK token/device 通道补齐","在 core-app 中补齐 account:get-auth-token 与 account:get-device-id 通道，供插件 CloudSync SDK 获取认证信息。","renderer 提供 account:get-auth-token 与 account:get-device-id 返回值；main 转发给插件请求；插件使用 CloudSync SDK 无需额外配置；对现有认证流程无回归。","AUTOFRONTEND","通道注册正确；异常时返回 null 且无敏感日志。","不影响现有插件通道；认证流程与设备标识不回归。","已完成","已完成","已完成","已提交","","apps/core-app/src/main/modules/plugin/plugin-module.ts:1;apps/core-app/src/renderer/src/modules/auth/account-channel.ts:1;apps/core-app/src/renderer/src/main.ts:1","picked_reason:补齐插件侧获取 auth token/device 的必需通道;review_initial:通道注册与异常处理检查通过;review_regression:仅新增通道与转发逻辑，不影响现有插件通道;evidence:code review;validation_limited:core-app 暂无快速可跑测试;manual_test:启动 core-app 后在插件内调用 accountSDK.getAuthToken()/getDeviceId() 验证返回;risk:low 通道新增;done_at:2026-02-05"
